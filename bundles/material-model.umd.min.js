/**
 * @license
 * Copyright (C) 2018 Gnucoop soc. coop.
 *
 * This file is part of the Gnucoop Angular Toolkit (gngt).
 *
 * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/cdk/collections"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@gngt/material/model",["exports","@angular/core","@angular/cdk/collections","rxjs","rxjs/operators"],e):e(((t=t||self).dewco=t.dewco||{},t.dewco.material=t.dewco.material||{},t.dewco.material.model={}),t.ng.core,t.ng.cdk.collections,t.rxjs,t.rxjs.operators)}(this,function(t,n,e,o,r){"use strict";var s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var p=function(){return(p=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},i=function(i){function t(t,e){void 0===e&&(e={});var r=i.call(this)||this;return r._service=t,r._baseParams=e,r._sort=null,r._filter=new o.BehaviorSubject(""),r._filters=new o.BehaviorSubject({}),r._paginator=null,r._data=new o.BehaviorSubject([]),r._sortParams=new o.BehaviorSubject(null),r._sortSubscription=o.Subscription.EMPTY,r._paginatorParams=new o.BehaviorSubject(null),r._paginatorSubscription=o.Subscription.EMPTY,r._dataSubscription=o.Subscription.EMPTY,r._refreshEvent=new n.EventEmitter,r}return function(t,e){function r(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(t,i),Object.defineProperty(t.prototype,"sort",{get:function(){return this._sort},set:function(t){this._sort=t,this._updateSort()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter.value},set:function(t){this._filter.next(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filters",{get:function(){return this._filters.value},set:function(t){this._filters.next(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paginator",{get:function(){return this._paginator},set:function(t){this._paginator=t,this._updatePaginator()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data.value},enumerable:!0,configurable:!0}),t.prototype.connect=function(t){return this._initData(),this._data.asObservable()},t.prototype.disconnect=function(t){this._dataSubscription.unsubscribe(),this._sortSubscription.unsubscribe(),this._paginatorSubscription.unsubscribe(),this._sortParams.complete(),this._paginatorParams.complete(),this._filters.complete()},t.prototype.refresh=function(){this._refreshEvent.next()},t.prototype._initData=function(){var c=this;this._dataSubscription=o.combineLatest(this._paginatorParams,this._sortParams,this._filter,this._filters,this._refreshEvent).pipe(r.startWith([null,null,null,null]),r.debounceTime(10),r.switchMap(function(t){var e,r=t[0],i=t[1],n=t[3],o=p({},c._baseParams,{selector:p({},n)});if(null!=r){var s=r;o.limit=s.pageSize,o.start=s.pageIndex*s.pageSize}if(null!=i){var a=i,u=""===a.direction?"asc":a.direction;o.sort=((e={})[a.active]=u,e)}return c._service.query(o)}),r.tap(function(t){var e=c.paginator;null!=e&&(e.length=t&&t.count?t.count:0)})).subscribe(function(t){c._data.next(t&&t.results?t.results:[])}),this._refreshEvent.next()},t.prototype._updateSort=function(){this._sortSubscription.unsubscribe(),this._sortSubscription=null!=this._sort?this._sort.sortChange.subscribe(this._sortParams):o.Subscription.EMPTY},t.prototype._updatePaginator=function(){this._paginatorSubscription.unsubscribe(),this._paginatorSubscription=null!=this._paginator?this._paginator.page.subscribe(this._paginatorParams):o.Subscription.EMPTY},t}(e.DataSource);t.ModelDataSource=i,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=material-model.umd.min.js.map
