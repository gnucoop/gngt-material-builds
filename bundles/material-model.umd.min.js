/**
 * @license
 * Copyright (C) 2018 Gnucoop soc. coop.
 *
 * This file is part of the Gnucoop Angular Toolkit (gngt).
 *
 * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/cdk/collections"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@gngt/material/model",["exports","@angular/core","@angular/cdk/collections","rxjs","rxjs/operators"],e):e(((t=t||self).gngt=t.gngt||{},t.gngt.material=t.gngt.material||{},t.gngt.material.model={}),t.ng.core,t.ng.cdk.collections,t.rxjs,t.rxjs.operators)}(this,function(t,i,e,n,r){"use strict";var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var a,s,u,_=function(){return(_=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},c=(u=e.DataSource,o(a=p,s=u),void(a.prototype=null===s?Object.create(s):(l.prototype=s.prototype,new l)),Object.defineProperty(p.prototype,"sort",{get:function(){return this._sort},set:function(t){this._sort=t,this._updateSort()},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"filter",{get:function(){return this._filter.value},set:function(t){this._filter.next(t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"freeTextSearchFields",{get:function(){return this._freeTextSearchFields.value},set:function(t){this._freeTextSearchFields.next(t.slice())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"filters",{get:function(){return this._filters.value},set:function(t){this._filters.next(t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"paginator",{get:function(){return this._paginator},set:function(t){this._paginator=t,this._updatePaginator()},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"data",{get:function(){return this._data.value},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"dataModifier",{set:function(t){this._dataModifier=t},enumerable:!0,configurable:!0}),p.prototype.connect=function(t){return this._initData(),this._data.asObservable()},p.prototype.disconnect=function(t){this._dataSubscription.unsubscribe(),this._sortSubscription.unsubscribe(),this._paginatorSubscription.unsubscribe(),this._sortParams.complete(),this._paginatorParams.complete(),this._filters.complete()},p.prototype.refresh=function(){this._refreshEvent.next()},p.prototype._initData=function(){var h=this;this._dataSubscription=n.combineLatest(this._paginatorParams,this._sortParams,this._filter,this._freeTextSearchFields,this._filters,this._refreshEvent).pipe(r.startWith([null,null,null,null,null]),r.debounceTime(10),r.switchMap(function(t){var e,r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s={},u=(n||"").trim();null!=n&&null!=o&&0<u.length&&0<o.length&&(s.$or=o.map(function(t){var e={};return e[t]={$regex:u},e}));var c=_({},h._baseParams,{selector:_({},a,s)});if(null!=r){var l=r;c.limit=l.pageSize,c.start=l.pageIndex*l.pageSize}if(null!=i){var p=i,f=""===p.direction?"asc":p.direction;c.sort=((e={})[p.active]=f,e)}return h._service.query(c)}),r.tap(function(t){var e=h.paginator;null!=e&&(e.length=t&&t.count?t.count:0)}),r.map(function(t){return t&&t.results?t.results:[]}),r.switchMap(function(t){return null!=h._dataModifier?h._dataModifier(t):n.of(t)})).subscribe(function(t){h._data.next(t)}),this._refreshEvent.next()},p.prototype._updateSort=function(){this._sortSubscription.unsubscribe(),this._sortSubscription=null!=this._sort?this._sort.sortChange.subscribe(this._sortParams):n.Subscription.EMPTY},p.prototype._updatePaginator=function(){this._paginatorSubscription.unsubscribe(),this._paginatorSubscription=null!=this._paginator?this._paginator.page.subscribe(this._paginatorParams):n.Subscription.EMPTY},p);function l(){this.constructor=a}function p(t,e){void 0===e&&(e={});var r=u.call(this)||this;return r._service=t,r._baseParams=e,r._sort=null,r._filter=new n.BehaviorSubject(""),r._freeTextSearchFields=new n.BehaviorSubject([]),r._filters=new n.BehaviorSubject({}),r._paginator=null,r._data=new n.BehaviorSubject([]),r._sortParams=new n.BehaviorSubject(null),r._sortSubscription=n.Subscription.EMPTY,r._paginatorParams=new n.BehaviorSubject(null),r._paginatorSubscription=n.Subscription.EMPTY,r._dataSubscription=n.Subscription.EMPTY,r._refreshEvent=new i.EventEmitter,r}t.ModelDataSource=c,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=material-model.umd.min.js.map
